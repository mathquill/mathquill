(function($){ //takes in the jQuery function as an argument

var _, //temp variable of prototypes
  undefined,
  jQueryDataKey = '[[mathquill internal data]]';

/*************************************************
 * Helper functions
 ************************************************/   
var glyphs={
  //Each glyph is 2000px tall and centered horizontally at 0.
  "(":{
    d:"M 259,19.313304 Q 259,0 238.62318,0 226.82609,0 189.28985,31.115879 -53.08695,230.68668 -156.04347,456.00855 -259,681.33044 -259,999.9999 q 0,318.6696 102.95653,543.9915 102.95652,225.3219 345.33332,424.8927 Q 226.82609,2000 238.62318,2000 259,2000 259,1980.6867 q 0,-8.5837 -25.73913,-34.3348 -321.73913,-316.5236 -321.73913,-946.352 0,-629.82825 321.73913,-946.351844 Q 259,27.896995 259,19.313304 z",
    attr:{
      fill:'#000',
      stroke:'none'
    },
    width:15
  },
  ")":{
    d:"M -259,19.313304 Q -259,0 -238.62318,0 -226.82609,0 -189.28985,31.115879 53.08695,230.68668 156.04347,456.00855 259,681.33044 259,999.9999 259,1318.6695 156.04347,1543.9914 53.08695,1769.3133 -189.28985,1968.8841 -226.82609,2000 -238.62318,2000 -259,2000 -259,1980.6867 q 0,-8.5837 25.73913,-34.3348 321.73913,-316.5236 321.73913,-946.352 0,-629.82825 -321.73913,-946.351844 Q -259,27.896995 -259,19.313304 z",
    attr:{
      fill:'#000',
      stroke:'none'
    },
    width:15
  },
  "[":{
    d:"m 195,50 -390,0 0,1900 390,0",
    width:20,
    attr:{
      'stroke-width':1,
      'stroke-linecap':'round',
      'stroke-linejoin':'miter',
      'stroke-miterlimit':4,
      'stroke-opacity':1,
      'stroke-dasharray':''
    }
  },
  "]":{
    d:"m -195,50 390,0 0,1900 -390,0",
    width:20,
    attr:{
      'stroke-width':1,
      'stroke-linecap':'round',
      'stroke-linejoin':'miter',
      'stroke-miterlimit':4,
      'stroke-opacity':1,
      'stroke-dasharray':''
    }
  },
  "{":{
    d:"M 400,24.678112 Q 400,0 354.88309,0 163.41129,0 41.26547,83.690988 -39.06464,138.41202 -61.07289,208.15451 -75.37825,253.21889 -75.37825,368.02575 v 335.83691 q 0,125.53649 -79.22971,194.20605 -79.22973,68.66948 -209.07842,78.32613 Q -400,978.54077 -400,998.92703 q 0,20.38627 19.80743,23.60517 19.80743,3.2189 38.51444,4.2918 266.29988,33.2618 266.29988,270.3863 v 335.8369 q 0,114.8069 14.30536,159.8713 22.00825,69.7424 102.33836,124.4635 Q 161.21045,2000 354.88309,2000 400,2000 400,1978.0043 q 0,-21.9957 -19.80742,-26.2876 -169.46355,-9.6566 -260.79781,-100.8583 -46.21733,-46.1374 -59.42228,-122.3176 -5.50206,-36.4807 -5.50206,-138.412 v -297.2103 q 0,-95.4936 -23.10867,-141.631 Q -20.35762,1048.2833 -190.92159,999.99999 -20.35762,951.71673 31.36176,848.71245 54.47043,803.64807 54.47043,708.15451 v -297.2103 q 0,-101.93133 5.50206,-138.41202 13.20495,-76.18026 59.42228,-122.3176 Q 210.72903,59.012876 380.19258,49.356223 400,45.064378 400,24.678112 z",
    width:20,
    attr:{
      fill:'#000',
      stroke:'none'
    }
  },
  "|":{
    d:"M 0,50 0,1950",
    width:10,
    attr:{
      'stroke-width':1,
      'stroke-linecap':'round',
      'stroke-linejoin':'miter',
      'stroke-miterlimit':4,
      'stroke-opacity':1,
      'stroke-dasharray':''
    }
  },
  "}":{
    d:"M -400,24.678112 Q -400,0 -354.88309,0 -163.41129,0 -41.26547,83.690988 39.06464,138.41202 61.07289,208.15451 75.37825,253.21889 75.37825,368.02575 v 335.83691 q 0,125.53649 79.22971,194.20605 79.22973,68.66948 209.07842,78.32613 Q 400,978.54077 400,998.92703 q 0,20.38627 -19.80743,23.60517 -19.80743,3.2189 -38.51444,4.2918 -266.29988,33.2618 -266.29988,270.3863 v 335.8369 q 0,114.8069 -14.30536,159.8713 Q 39.06464,1862.6609 -41.26547,1917.382 -161.21045,2000 -354.88309,2000 -400,2000 -400,1978.0043 q 0,-21.9957 19.80742,-26.2876 169.46355,-9.6566 260.79781,-100.8583 46.21733,-46.1374 59.42228,-122.3176 5.50206,-36.4807 5.50206,-138.412 v -297.2103 q 0,-95.4936 23.10867,-141.631 Q 20.35762,1048.2833 190.92159,999.99999 20.35762,951.71673 -31.36176,848.71245 -54.47043,803.64807 -54.47043,708.15451 v -297.2103 q 0,-101.93133 -5.50206,-138.41202 -13.20495,-76.18026 -59.42228,-122.3176 Q -210.72903,59.012876 -380.19258,49.356223 -400,45.064378 -400,24.678112 z",
    width:20,
    attr:{
      fill:'#000',
      stroke:'none'
    }
  },
  "&lang;":{
    d:"m 211,43 -422,957 422,957",
    attr:{
      'stroke-width':1,
      'stroke-linecap':'round',
      'stroke-linejoin':'miter',
      'stroke-miterlimit':4,
      'stroke-opacity':1,
      'stroke-dasharray':''
    },
    width:20
  },
  "&rang;":{
    d:"m -211,43 422,957 -422,957",
    attr:{
      'stroke-width':1,
      'stroke-linecap':'round',
      'stroke-linejoin':'miter',
      'stroke-miterlimit':4,
      'stroke-opacity':1,
      'stroke-dasharray':''
    },
    width:20
  }
}
Raphael.fn.bracket = function(character,height) {
  var g = glyphs[character];
  return this.path(g.d).attr(g.attr).scale(g.width/2000,height/2000,4,0);
};

Raphael.el.bracketResize = function(character, height) {
  var g = glyphs[character];
  return this.scale(g.width/2000,height/2000,4,0);
};