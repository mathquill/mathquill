!function(){function t(){}function e(t){var e=U.call(arguments,1);return function(){return t.apply(this,e)}}function n(t,e){if(!e)throw new Error("prayer failed: "+t)}function i(t){n("a direction was passed",t===G||t===X)}function r(e,n,i,r){function s(){u=a;var t=c.selection?"$"+c.selection.latex()+"$":"";d.select(t)}function o(){h.detach(),l.focused=!1}var c,h,l,u,p,f,d,m=e.contents().detach();return i||e.addClass("mathquill-rendered-math"),n.jQ=e.attr(F,n.id),n.revert=function(){e.empty().unbind(".mathquill").removeClass("mathquill-rendered-math mathquill-editable mathquill-textbox").append(m)},c=n.cursor=I(n),n.renderLatex(m.text()),h=n.textarea=Z('<span class="textarea"><textarea></textarea></span>'),l=h.children(),n.selectionChanged=function(){u===a&&(u=setTimeout(s)),ut(e[0])},e.bind("selectstart.mathquill",function(t){t.target!==l[0]&&t.preventDefault(),t.stopPropagation()}),f=c.blink,e.bind("mousedown.mathquill",function(n){function i(t){return c.seek(Z(t.target),t.pageX,t.pageY),(c[G]!==p[G]||c.parent!==p.parent)&&c.selectFrom(p),!1}function s(t){return delete t.target,i(t)}function o(t){p=a,c.blink=f,c.selection||(r?c.show():h.detach()),e.unbind("mousemove",i),Z(t.target.ownerDocument).unbind("mousemove",s).unbind("mouseup",o)}return setTimeout(function(){l.focus(),l.focused=!0}),c.blink=t,c.seek(Z(n.target),n.pageX,n.pageY),p=Y(c.parent,c[G],c[X]),r||l.focused||e.prepend(h),e.mousemove(i),Z(n.target.ownerDocument).mousemove(s).mouseup(o),!1}),r?(d=K(l,{container:e,key:function(t,e){c.parent.bubble("onKey",t,e)},text:function(t){c.parent.bubble("onText",t)},cut:function(t){c.selection&&setTimeout(function(){c.prepareEdit(),c.parent.bubble("redraw")}),t.stopPropagation()},paste:function(t){t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}",c.writeLatex(t).show()}}),e.prepend(h),e.addClass("mathquill-editable"),i&&e.addClass("mathquill-textbox"),l.focus(function(t){c.parent||c.insAtRightEnd(n),c.parent.jQ.addClass("hasCursor"),c.selection?(c.selection.jQ.removeClass("blur"),setTimeout(n.selectionChanged)):c.show(),t.stopPropagation()}).blur(function(t){c.hide().parent.blur(),c.selection&&c.selection.jQ.addClass("blur"),t.stopPropagation()}),void e.bind("focus.mathquill blur.mathquill",function(t){l.trigger(t)}).blur()):(d=K(l,{container:e}),e.bind("cut paste",!1).bind("copy",s).prepend('<span class="selectable">$'+n.latex()+"$</span>"),void l.blur(function(){c.clearSelection(),setTimeout(o)}))}function s(t,e,n){return H(k,{ctrlSeq:t,htmlTemplate:"<"+e+" "+n+">&0</"+e+">"})}var a,o,c,h,l,u,p,f,d,m,g,b,v,w,x,j,q,k,y,Q,C,S,L,D,O,E,A,R,T,z,B,$,I,_,W=window.jQuery,M="mathquill-command-id",F="mathquill-block-id",P=Math.min,U=(Math.max,[].slice),H=function(t,e,n){function i(t){return"object"==typeof t}function r(t){return"function"==typeof t}function s(){}return function a(o,c){function h(){var t=new l;return r(t.init)&&t.init.apply(t,arguments),t}function l(){}var u,p,f;return c===n&&(c=o,o=Object),h.Bare=l,u=s[t]=o[t],p=l[t]=h[t]=h.p=new s,p.constructor=h,h.mixin=function(e){return l[t]=h[t]=a(h,e)[t],h},(h.open=function(t){if(f={},r(t)?f=t.call(h,p,u,h,o):i(t)&&(f=t),i(f))for(var n in f)e.call(f,n)&&(p[n]=f[n]);return r(p.init)||(p.init=o),h})(c)}}("prototype",{}.hasOwnProperty),K=function(){function e(t){var e,i=t.which||t.keyCode,r=n[i],s=[];return t.ctrlKey&&s.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&s.push("Meta"),t.altKey&&s.push("Alt"),t.shiftKey&&s.push("Shift"),e=r||String.fromCharCode(i),s.length||r?(s.push(e),s.join("-")):e}var n={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(n,i){function r(t){j=t,clearTimeout(q),q=setTimeout(t)}function s(e){j(),j=t,clearTimeout(q),w.val(e),e&&w[0].select()}function a(){var t=w[0];return"selectionStart"in t?t.selectionStart!==t.selectionEnd:!1}function o(t){var e=w.val();w.val(""),e&&t(e)}function c(){g(e(k),k)}function h(t){k=t,y=null,c()}function l(t){k&&y&&c(),y=t,r(u)}function u(){a()||o(m)}function p(){k=y=null}function f(t){w.focus(),r(d)}function d(){o(b)}var m,g,b,v,w,x,j,q,k=null,y=null;return i||(i={}),m=i.text||t,g=i.key||t,b=i.paste||t,v=i.cut||t,w=W(n),x=W(i.container||w),j=t,x.bind("keydown keypress input keyup focusout paste",function(){j()}),x.bind({keydown:h,keypress:l,focusout:p,cut:v,paste:f}),{select:s}}}(),N=H(function(t,e,i){function r(t,e){throw t=t?"'"+t+"'":"EOF","Parse Error: "+e+" at "+t}var s,a,o,c,h,l,u,p,f,d,m,g,b;t.init=function(t){this._=t},t.parse=function(t){function e(t,e){return e}return this.skip(b)._(t,e,r)},t.or=function(t){n("or is passed a parser",t instanceof i);var e=this;return i(function(n,i,r){function s(e){return t._(n,i,r)}return e._(n,i,s)})},t.then=function(t){var e=this;return i(function(r,s,a){function o(e,r){var o=t instanceof i?t:t(r);return n("a parser is returned",o instanceof i),o._(e,s,a)}return e._(r,o,a)})},t.many=function(){var t=this;return i(function(e,n,i){function r(t,n){return e=t,a.push(n),!0}function s(){return!1}for(var a=[];t._(e,r,s););return n(e,a)})},t.times=function(t,e){arguments.length<2&&(e=t);var n=this;return i(function(i,r,s){function a(t,e){return u.push(e),i=t,!0}function o(t,e){return h=e,i=t,!1}function c(t,e){return!1}var h,l,u=[],p=!0;for(l=0;t>l;l+=1)if(p=n._(i,a,o),!p)return s(i,h);for(;e>l&&p;l+=1)p=n._(i,a,c);return r(i,u)})},t.result=function(t){return this.then(o(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.map=function(t){return this.then(function(e){return o(t(e))})},t.skip=function(t){return this.then(function(e){return t.result(e)})},s=this.string=function(t){var e=t.length,n="expected '"+t+"'";return i(function(i,r,s){var a=i.slice(0,e);return a===t?r(i.slice(e),a):s(i,n)})},a=this.regex=function(t){n("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return i(function(n,i,r){var s,a=t.exec(n);return a?(s=a[0],i(n.slice(s.length),s)):r(n,e)})},o=i.succeed=function(t){return i(function(e,n){return n(e,t)})},c=i.fail=function(t){return i(function(e,n,i){return i(e,t)})},h=i.letter=a(/^[a-z]/i),l=i.letters=a(/^[a-z]*/i),u=i.digit=a(/^[0-9]/),p=i.digits=a(/^[0-9]*/),f=i.whitespace=a(/^\s+/),d=i.optWhitespace=a(/^\s*/),m=i.any=i(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),g=i.all=i(function(t,e,n){return e("",t)}),b=i.eof=i(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)})}),G=-1,X=1,Z=H(W,function(t){t.insDirOf=function(t,e){return t===G?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===G?this.prependTo(e):this.appendTo(e)}}),Y=H(function(t){t.parent=0,t[G]=0,t[X]=0,t.init=function(t,e,n){this.parent=t,this[G]=e,this[X]=n}}),J=H(function(t){t[G]=0,t[X]=0,t.parent=0,t.init=function(){this.ends={},this.ends[G]=0,this.ends[X]=0},t.children=function(){return V(this.ends[G],this.ends[X])},t.eachChild=function(t){return this.children().each(t)},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.adopt=function(t,e,n){return V(this,this).adopt(t,e,n),this},t.disown=function(){return V(this,this).disown(),this}}),V=H(function(t){function e(t,e,i){n("a parent is always present",t),n("leftward is properly set up",function(){return e?e[X]===i&&e.parent===t:t.ends[G]===i}()),n("rightward is properly set up",function(){return i?i[G]===e&&i.parent===t:t.ends[X]===e}())}t.init=function(t,e){n("no half-empty fragments",!t==!e),this.ends={},t&&(n("left end node is passed to Fragment",t instanceof J),n("right end node is passed to Fragment",e instanceof J),n("leftEnd and rightEnd have the same parent",t.parent===e.parent),this.ends[G]=t,this.ends[X]=e)},t.adopt=function(t,n,i){var r,s,a;return e(t,n,i),r=this,r.disowned=!1,(s=r.ends[G])?(a=r.ends[X],n||(t.ends[G]=s),i?i[G]=a:t.ends[X]=a,r.ends[X][X]=i,r.each(function(e){e[G]=n,e.parent=t,n&&(n[X]=e),n=e}),r):this},t.disown=function(){var t,n,i=this,r=i.ends[G];return!r||i.disowned?i:(i.disowned=!0,t=i.ends[X],n=r.parent,e(n,r[G],r),e(n,t,t[X]),r[G]?r[G][X]=t[X]:n.ends[G]=t[X],t[X]?t[X][G]=r[G]:n.ends[X]=r[G],i)},t.each=function(t){var e=this,n=e.ends[G];if(!n)return e;for(;n!==e.ends[X][X]&&t.call(e,n)!==!1;n=n[X]);return e},t.fold=function(t,e){return this.each(function(n){t=e.call(this,t,n)}),t}}),tt=function(){var t=0;return function(){return t+=1}}(),et=H(J,function(t,e){t.init=function(t){e.init.call(this),this.id=tt(),et[this.id]=this},t.toString=function(){return"[MathElement "+this.id+"]"},t.bubble=function(t){var e,n,i=U.call(arguments,1);for(e=this;e&&(n=e[t]&&e[t].apply(e,i),n!==!1);e=e.parent);return this},t.postOrder=function(t){var e,n=U.call(arguments,1);"string"==typeof t&&(e=t,t=function(t){e in t&&t[e].apply(t,n)}),function i(e){e.eachChild(i),t(e)}(this)},t.jQ=Z(),t.jQadd=function(t){this.jQ=this.jQ.add(t)},this.jQize=function(t){var e=Z(t);return e.find("*").andSelf().each(function(){var t=Z(this),e=t.attr("mathquill-command-id"),n=t.attr("mathquill-block-id");e&&et[e].jQadd(t),n&&et[n].jQadd(t)}),e},t.finalizeInsert=function(){var t=this;t.postOrder("finalizeTree"),t.postOrder("blur"),t.postOrder("respace"),t[X].respace&&t[X].respace(),t[G].respace&&t[G].respace(),t.postOrder("redraw"),t.bubble("redraw")}}),nt=H(et,function(e,i){e.init=function(t,e,n){var r=this;i.init.call(r),r.ctrlSeq||(r.ctrlSeq=t),e&&(r.htmlTemplate=e),n&&(r.textTemplate=n)},e.replaces=function(t){t.disown(),this.replacedFragment=t},e.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},e.parser=function(){var t=$.block,e=this;return t.times(e.numBlocks()).map(function(t){e.blocks=t;for(var n=0;n<t.length;n+=1)t[n].adopt(e,e.ends[X],0);return e})},e.createLeftOf=function(t){var e=this,n=e.replacedFragment;e.createBlocks(),et.jQize(e.html()),n&&(n.adopt(e.ends[G],0,0),n.jQ.appendTo(e.ends[G].jQ)),t.jQ.before(e.jQ),t[G]=e.adopt(t.parent,t[G],t[X]),e.finalizeInsert(t),e.placeCursor(t)},e.createBlocks=function(){var t,e,n=this,i=n.numBlocks(),r=n.blocks=Array(i);for(t=0;i>t;t+=1)e=r[t]=rt(),e.adopt(n,n.ends[X],0)},e.respace=t,e.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[G],function(t,e){return t.isEmpty()?t:e}))},e.remove=function(){return this.disown(),this.jQ.remove(),this.postOrder(function(t){delete et[t.id]}),this},e.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},e.html=function(){var t,e,i,r=this,s=r.blocks,a=" mathquill-command-id="+r.id,o=r.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(n("no unmatched angle brackets",o.join("")===this.htmlTemplate),t=0,e=o[0];e;t+=1,e=o[t])if("/>"===e.slice(-2))o[t]=e.slice(0,-2)+a+"/>";else if("<"===e.charAt(0)){n("not an unmatched top-level close tag","/"!==e.charAt(1)),o[t]=e.slice(0,-1)+a+">",i=1;do t+=1,e=o[t],n("no missing close tags",e),"</"===e.slice(0,2)?i-=1:"<"===e.charAt(0)&&"/>"!==e.slice(-2)&&(i+=1);while(i>0)}return o.join("").replace(/>&(\d+)/g,function(t,e){return" mathquill-block-id="+s[e].id+">"+s[e].join("html")})},e.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},e.textTemplate=[""],e.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(n,i){e+=1;var r=i.text();return n&&"("===t.textTemplate[e]&&"("===r[0]&&")"===r.slice(-1)?n+r.slice(1,-1)+t.textTemplate[e]:n+i.text()+(t.textTemplate[e]||"")})}}),it=H(nt,function(e,n){e.init=function(t,e,i){i||(i=t&&t.length>1?t.slice(1):t),n.init.call(this,t,e,[i])},e.parser=function(){return N.succeed(this)},e.numBlocks=function(){return 0},e.replaces=function(t){t.remove()},e.createBlocks=t,e.latex=function(){return this.ctrlSeq},e.text=function(){return this.textTemplate},e.placeCursor=t,e.isEmpty=function(){return!0}}),rt=H(et,function(t){t.join=function(t){return this.foldChildren("",function(e,n){return e+n[t]()})},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[G]===this.ends[X]?this.ends[G].text():"("+this.join("text")+")"},t.isEmpty=function(){return 0===this.ends[G]&&0===this.ends[X]},t.write=function(t,e,n){var i;i=e.match(/^[a-eg-zA-Z]$/)?D(e):(i=ht[e]||lt[e])?i(e):O(e),n&&i.replaces(n),i.createLeftOf(t)},t.focus=function(){return this.jQ.addClass("hasCursor"),this.jQ.removeClass("empty"),this},t.blur=function(){return this.jQ.removeClass("hasCursor"),this.isEmpty()&&this.jQ.addClass("empty"),this}}),st=H(V,function(t,e){t.init=function(t,n){e.init.call(this,t,n||t),this.jQ=this.fold(Z(),function(t,e){return e.jQ.add(t)})},t.latex=function(){return this.fold("",function(t,e){return t+e.latex()})},t.remove=function(){return this.jQ.remove(),this.each(function(t){t.postOrder(function(t){delete et[t.id]})}),this.disown()}}),at=H(rt,function(t,e){t.latex=function(){return e.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},t.text=function(){return this.foldChildren("",function(t,e){return t+e.text()})},t.renderLatex=function(t){var e=this.jQ;e.children().slice(1).remove(),this.ends[G]=this.ends[X]=0,delete this.cursor.selection,this.cursor.insAtRightEnd(this).writeLatex(t)},t.onKey=function(t,e){var n;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":for(;this.cursor[G]||this.cursor.selection;)this.cursor.backspace();break;case"Shift-Backspace":case"Backspace":this.cursor.backspace();break;case"Esc":case"Tab":case"Spacebar":if(n=this.cursor.parent,n===this.cursor.root)return void("Spacebar"===t&&e.preventDefault());this.cursor.prepareMove(),n[X]?this.cursor.insAtLeftEnd(n[X]):this.cursor.insRightOf(n.parent);break;case"Shift-Tab":case"Shift-Esc":case"Shift-Spacebar":if(n=this.cursor.parent,n===this.cursor.root)return void("Shift-Spacebar"===t&&e.preventDefault());this.cursor.prepareMove(),n[G]?this.cursor.insAtRightEnd(n[G]):this.cursor.insLeftOf(n.parent);break;case"Enter":break;case"End":this.cursor.prepareMove().insAtRightEnd(this.cursor.parent);break;case"Ctrl-End":this.cursor.prepareMove().insAtRightEnd(this);break;case"Shift-End":for(;this.cursor[X];)this.cursor.selectRight();break;case"Ctrl-Shift-End":for(;this.cursor[X]||this.cursor.parent!==this;)this.cursor.selectRight();break;case"Home":this.cursor.prepareMove().insAtLeftEnd(this.cursor.parent);break;case"Ctrl-Home":this.cursor.prepareMove().insAtLeftEnd(this);break;case"Shift-Home":for(;this.cursor[G];)this.cursor.selectLeft();break;case"Ctrl-Shift-Home":for(;this.cursor[G]||this.cursor.parent!==this;)this.cursor.selectLeft();break;case"Left":this.cursor.moveLeft();break;case"Shift-Left":this.cursor.selectLeft();break;case"Ctrl-Left":break;case"Right":this.cursor.moveRight();break;case"Shift-Right":this.cursor.selectRight();break;case"Ctrl-Right":break;case"Up":this.cursor.moveUp();break;case"Down":this.cursor.moveDown();break;case"Shift-Up":if(this.cursor[G])for(;this.cursor[G];)this.cursor.selectLeft();else this.cursor.selectLeft();case"Shift-Down":if(this.cursor[X])for(;this.cursor[X];)this.cursor.selectRight();else this.cursor.selectRight();case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":for(;this.cursor[X]||this.cursor.selection;)this.cursor.deleteForward();break;case"Shift-Del":case"Del":this.cursor.deleteForward();break;case"Meta-A":case"Ctrl-A":if(this!==this.cursor.root)return;for(this.cursor.prepareMove().insAtRightEnd(this);this.cursor[G];)this.cursor.selectLeft();break;default:return!1}return e.preventDefault(),!1},t.onText=function(t){return this.cursor.write(t),!1}}),ot=H(nt,function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mathquill-rendered-math">&0</span>',t.createBlocks=function(){this.ends[G]=this.ends[X]=at(),this.blocks=[this.ends[G]],this.ends[G].parent=this,this.ends[G].cursor=this.cursor,this.ends[G].write=function(t,e,n){"$"!==e?rt.prototype.write.call(this,t,e,n):this.isEmpty()?(t.insRightOf(this.parent).backspace().show(),O("\\$","$").createLeftOf(t)):t[X]?t[G]?rt.prototype.write.call(this,t,e,n):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[G].latex()+"$"}}),ct=H(rt,function(t){t.renderLatex=function(t){var e,n,i,r,s,a,o,c,h,l,u,p=this,f=p.cursor;if(p.jQ.children().slice(1).remove(),p.ends[G]=p.ends[X]=0,delete f.selection,f.show().insAtRightEnd(p),e=N.regex,n=N.string,i=N.eof,r=N.all,s=n("$").then($).skip(n("$").or(i)).map(function(t){var e,n=ot(f);return n.createBlocks(),e=n.ends[G],t.children().adopt(e,0,0),n}),a=n("\\$").result("$"),o=a.or(e(/^[^$]/)).map(O),c=s.or(o).many(),h=c.skip(i).or(r.result(!1)).parse(t)){for(l=0;l<h.length;l+=1)h[l].adopt(p,p.ends[X],0);u=p.join("html"),et.jQize(u).appendTo(p.jQ),this.finalizeInsert()}},t.onKey=function(t){"Spacebar"!==t&&"Shift-Spacebar"!==t&&at.prototype.onKey.apply(this,arguments)},t.onText=at.prototype.onText,t.write=function(t,e,n){if(n&&n.remove(),"$"===e)ot(t).createLeftOf(t);else{var i;"<"===e?i="&lt;":">"===e&&(i="&gt;"),O(e,i).createLeftOf(t)}}}),ht={},lt={},ut=t,pt=document.createElement("div"),ft=pt.style,dt={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(h in dt)if(h in ft){c=h;break}c?o=function(t,e,n){t.css(c,"scale("+e+","+n+")")}:"filter"in ft?(ut=function(t){t.className=t.className},o=function(t,e,n){function i(){t.css("marginRight",(r.width()-1)*(e-1)/e+"px")}var r,s;e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("matrixed-container")||t.addClass("matrixed-container").wrapInner('<span class="matrixed"></span>'),r=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')"),i(),s=setInterval(i),Z(window).load(function(){clearTimeout(s),i()})}):o=function(t,e,n){t.css("fontSize",n+"em")},l=H(nt,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+" "+i+">&0</"+n+">")}}),lt.mathrm=e(l,"\\mathrm","span",'class="roman font"'),lt.mathit=e(l,"\\mathit","i",'class="font"'),lt.mathbf=e(l,"\\mathbf","b",'class="font"'),lt.mathsf=e(l,"\\mathsf","span",'class="sans-serif font"'),lt.mathtt=e(l,"\\mathtt","span",'class="monospace font"'),lt.underline=e(l,"\\underline","span",'class="non-leaf underline"'),lt.overline=lt.bar=e(l,"\\overline","span",'class="non-leaf overline"'),u=H(nt,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+' class="non-leaf">&0</'+n+">",[i])},t.finalizeTree=function(){function t(t){var e=this.parent,n=t;do{if(n[X])return t.insLeftOf(e),!1;n=n.parent.parent}while(n!==e);return t.insRightOf(e),!1}n("SupSub is only _ and ^","^"===this.ctrlSeq||"_"===this.ctrlSeq),"_"===this.ctrlSeq?(this.down=this.ends[G],this.ends[G].up=t):(this.up=this.ends[G],this.ends[G].down=t)},t.latex=function(){var t=this.ends[G].latex();return 1===t.length?this.ctrlSeq+t:this.ctrlSeq+"{"+(t||" ")+"}"},t.redraw=function(){this[G]&&this[G].respace(),this[G]instanceof u||(this.respace(),!this[X]||this[X]instanceof u||this[X].respace())},t.respace=function(){if("\\int "===this[G].ctrlSeq||this[G]instanceof u&&this[G].ctrlSeq!=this.ctrlSeq&&this[G][G]&&"\\int "===this[G][G].ctrlSeq?this.limit||(this.limit=!0,this.jQ.addClass("limit")):this.limit&&(this.limit=!1,this.jQ.removeClass("limit")),this.respaced=this[G]instanceof u&&this[G].ctrlSeq!=this.ctrlSeq&&!this[G].respaced,this.respaced){var t=+this.jQ.css("fontSize").slice(0,-2),e=this[G].jQ.outerWidth(),n=this.jQ.outerWidth();this.jQ.css({left:(this.limit&&"_"===this.ctrlSeq?-.25:0)-e/t+"em",marginRight:.1-P(n,e)/t+"em"})}else this.limit&&"_"===this.ctrlSeq?this.jQ.css({left:"-.25em",marginRight:""}):this.jQ.css({left:"",marginRight:""});return this[X]instanceof u&&this[X].respace(),this}}),lt.subscript=lt._=e(u,"_","sub","_"),lt.superscript=lt.supscript=lt["^"]=e(u,"^","sup","**"),p=lt.frac=lt.dfrac=lt.cfrac=lt.fraction=H(nt,function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="fraction non-leaf"><span class="numerator">&0</span><span class="denominator">&1</span><span style="display:inline-block;width:0">&nbsp;</span></span>',t.textTemplate=["(","/",")"],t.finalizeTree=function(){this.up=this.ends[X].up=this.ends[G],this.down=this.ends[G].down=this.ends[X]}}),f=lt.over=ht["/"]=H(p,function(t,e){t.createLeftOf=function(t){if(!this.replacedFragment){for(var n=t[G];n&&!(n instanceof R||n instanceof k||n instanceof z||/^[,;:]$/.test(n.ctrlSeq));)n=n[G];n instanceof z&&n[X]instanceof u&&(n=n[X],n[X]instanceof u&&n[X].ctrlSeq!=n.ctrlSeq&&(n=n[X])),n!==t[G]&&(this.replaces(st(n[X]||t.parent.ends[G],t[G])),t[G]=n)}e.createLeftOf.call(this,t)}}),d=lt.sqrt=lt["√"]=H(nt,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="non-leaf"><span class="scaled sqrt-prefix">&radic;</span><span class="non-leaf sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return $.optBlock.then(function(t){return $.block.map(function(e){var n=g();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(e.parser.call(this))},t.redraw=function(){var t=this.ends[X].jQ;o(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),m=lt.vec=H(nt,function(t,e){t.ctrlSeq="\\vec",t.htmlTemplate='<span class="non-leaf"><span class="vector-prefix">&rarr;</span><span class="vector-stem">&0</span></span>',t.textTemplate=["vec(",")"]}),g=lt.nthroot=H(d,function(t,e){t.htmlTemplate='<sup class="nthroot non-leaf">&0</sup><span class="scaled"><span class="sqrt-prefix scaled">&radic;</span><span class="sqrt-stem non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[G].latex()+"]{"+this.ends[X].latex()+"}"}}),b=H(nt,function(t,e){t.init=function(t,n,i,r){e.init.call(this,"\\left"+i,'<span class="non-leaf"><span class="scaled paren">'+t+'</span><span class="non-leaf">&0</span><span class="scaled paren">'+n+"</span></span>",[t,n]),this.end="\\right"+r},t.jQadd=function(){e.jQadd.apply(this,arguments);var t=this.jQ;this.bracketjQs=t.children(":first").add(t.children(":last"))},t.latex=function(){return this.ctrlSeq+this.ends[G].latex()+this.end},t.redraw=function(){var t=this.ends[G].jQ,e=t.outerHeight()/+t.css("fontSize").slice(0,-2);o(this.bracketjQs,P(1+.2*(e-1),1.2),1.05*e)}}),lt.left=H(nt,function(t){t.parser=function(){var t=N.regex,e=N.string,n=N.succeed,i=N.optWhitespace;return i.then(t(/^(?:[([|]|\\\{)/)).then(function(r){"\\"===r.charAt(0)&&(r=r.slice(1));var s=ht[r]();return $.map(function(t){s.blocks=[t],t.adopt(s,0,0)}).then(e("\\right")).skip(i).then(t(/^(?:[\])|]|\\\})/)).then(function(t){return t.slice(-1)!==s.end.slice(-1)?N.fail("open doesn't match close"):n(s)})})}}),lt.right=H(nt,function(t){t.parser=function(){return N.fail("unmatched \\right")}}),lt.lbrace=ht["{"]=e(b,"{","}","\\{","\\}"),lt.langle=lt.lang=e(b,"&lang;","&rang;","\\langle ","\\rangle "),v=H(b,function(t,e){t.createLeftOf=function(t){t[X]||!t.parent.parent||t.parent.parent.end!==this.end||this.replacedFragment?e.createLeftOf.call(this,t):t.insRightOf(t.parent.parent)},t.placeCursor=function(t){this.ends[G].blur(),t.insRightOf(this)}}),lt.rbrace=ht["}"]=e(v,"{","}","\\{","\\}"),lt.rangle=lt.rang=e(v,"&lang;","&rang;","\\langle ","\\rangle "),w=function(t,e){t.init=function(t,n){e.init.call(this,t,n,t,n)}},x=H(b,w),lt.lparen=ht["("]=e(x,"(",")"),lt.lbrack=lt.lbracket=ht["["]=e(x,"[","]"),j=H(v,w),lt.rparen=ht[")"]=e(j,"(",")"),lt.rbrack=lt.rbracket=ht["]"]=e(j,"[","]"),q=lt.lpipe=lt.rpipe=ht["|"]=H(x,function(t,e){t.init=function(){e.init.call(this,"|","|")},t.createLeftOf=v.prototype.createLeftOf}),k=ht.$=lt.text=lt.textnormal=lt.textrm=lt.textup=lt.textmd=H(nt,function(t,e){t.ctrlSeq="\\text",t.htmlTemplate='<span class="text">&0</span>',t.replaces=function(t){t instanceof st?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.textTemplate=['"','"'],t.parser=function(){var t=this,e=N.string,n=N.regex,i=N.optWhitespace;return i.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map(function(e){var n,i,r;for(t.createBlocks(),n=t.ends[G],i=0;i<e.length;i+=1)r=O(e.charAt(i)),r.adopt(n,n.ends[X],0);return t})},t.createBlocks=function(){this.ends[G]=this.ends[X]=y(),this.blocks=[this.ends[G]],this.ends[G].parent=this},t.finalizeInsert=function(){this.ends[G].blur=function(){return delete this.blur,this},e.finalizeInsert.call(this)},t.createLeftOf=function(t){if(e.createLeftOf.call(this,this.cursor=t),this.replacedText)for(var n=0;n<this.replacedText.length;n+=1)this.ends[G].write(t,this.replacedText.charAt(n))}}),y=H(rt,function(t,e){t.onKey=function(t,e){return"Spacebar"===t||"Shift-Spacebar"===t?!1:void 0},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this.parent)},t.write=function(t,e,n){var i,r;return n&&n.remove(),"$"!==e?("<"===e?i="&lt;":">"===e&&(i="&gt;"),O(e,i).createLeftOf(t)):this.isEmpty()?(t.insRightOf(this.parent).backspace(),O("\\$","$").createLeftOf(t)):t[X]?t[G]?(r=k(),r.replaces(st(t[X],this.ends[X])),t.insRightOf(this.parent),r.adopt=function(){delete this.adopt,this.adopt.apply(this,arguments),this[G]=0},r.createLeftOf(t),r[G]=this.parent,t.insLeftOf(r)):t.insLeftOf(this.parent):t.insRightOf(this.parent),!1},t.blur=function(){if(this.jQ.removeClass("hasCursor"),this.isEmpty()){var t=this.parent,e=t.cursor;e.parent===this?this.jQ.addClass("empty"):(e.hide(),t.remove(),e[X]===t?e[X]=t[X]:e[G]===t&&(e[G]=t[G]),e.show().parent.bubble("redraw"))}return this},t.focus=function(){var t,n,i,r;return e.focus.call(this),t=this.parent,t[X].ctrlSeq===t.ctrlSeq?(n=this,i=t.cursor,r=t[X].ends[G],r.eachChild(function(t){t.parent=n,t.jQ.appendTo(n.jQ)}),this.ends[X]?this.ends[X][X]=r.ends[G]:this.ends[G]=r.ends[G],r.ends[G][G]=this.ends[X],this.ends[X]=r.ends[X],r.parent.remove(),i[G]?i.insRightOf(i[G]):i.insAtLeftEnd(this),i.parent.bubble("redraw")):t[G].ctrlSeq===t.ctrlSeq&&(i=t.cursor,i[G]?t[G].ends[G].focus():i.insAtRightEnd(t[G].ends[G])),this}}),lt.em=lt.italic=lt.italics=lt.emph=lt.textit=lt.textsl=s("\\textit","i",'class="text"'),lt.strong=lt.bold=lt.textbf=s("\\textbf","b",'class="text"'),lt.sf=lt.textsf=s("\\textsf","span",'class="sans-serif text"'),lt.tt=lt.texttt=s("\\texttt","span",'class="monospace text"'),lt.textsc=s("\\textsc","span",'style="font-variant:small-caps" class="text"'),lt.uppercase=s("\\uppercase","span",'style="text-transform:uppercase" class="text"'),lt.lowercase=s("\\lowercase","span",'style="text-transform:lowercase" class="text"'),Q=ht["\\"]=H(nt,function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="latex-command-input non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[G].focus=function(){return this.parent.jQ.addClass("hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("empty"),this},this.ends[G].blur=function(){return this.parent.jQ.removeClass("hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("empty"),this}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this.cursor=t.insAtRightEnd(this.ends[G]),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("blur").bind("mousedown mousemove",function(t){return Z(t.target=n).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}this.ends[G].write=function(t,e,n){n&&n.remove(),e.match(/[a-z]/i)?O(e).createLeftOf(t):(this.parent.renderCommand(),"\\"===e&&this.isEmpty()||this.parent.parent.write(t,e))}},t.latex=function(){return"\\"+this.ends[G].latex()+" "},t.onKey=function(t,e){return"Tab"===t||"Enter"===t||"Spacebar"===t?(this.renderCommand(),e.preventDefault(),!1):void 0},t.renderCommand=function(){this.jQ=this.jQ.last(),this.remove(),this[X]?this.cursor.insLeftOf(this[X]):this.cursor.insAtRightEnd(this.parent);var t=this.ends[G].latex();t||(t="backslash"),this.cursor.insertCmd(t,this._replacedFragment)}}),C=lt.binom=lt.binomial=H(nt,function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="paren scaled">(</span><span class="non-leaf"><span class="array non-leaf"><span>&0</span><span>&1</span></span></span><span class="paren scaled">)</span>',t.textTemplate=["choose(",",",")"],t.redraw=function(){var t=this.jQ.eq(1),e=t.outerHeight()/+t.css("fontSize").slice(0,-2),n=this.jQ.filter(".paren");o(n,P(1+.2*(e-1),1.2),1.05*e)}}),S=lt.choose=H(C,function(t){t.createLeftOf=f.prototype.createLeftOf}),L=lt.vector=H(nt,function(t,e){t.ctrlSeq="\\vector",t.htmlTemplate='<span class="array"><span>&0</span></span>',t.latex=function(){return"\\begin{matrix}"+this.foldChildren([],function(t,e){return t.push(e.latex()),t}).join("\\\\")+"\\end{matrix}"},t.text=function(){return"["+this.foldChildren([],function(t,e){return t.push(e.text()),t}).join()+"]"},t.createLeftOf=function(t){e.createLeftOf.call(this,this.cursor=t)},t.onKey=function(t,e){var n,i=this.cursor.parent;if(i.parent===this){if("Enter"===t)return n=rt(),n.parent=this,n.jQ=Z("<span></span>").attr(F,n.id).insertAfter(i.jQ),i[X]?i[X][G]=n:this.ends[X]=n,n[X]=i[X],i[X]=n,n[G]=i,this.bubble("redraw").cursor.insAtRightEnd(n),e.preventDefault(),!1;if("Tab"===t&&!i[X])return i.isEmpty()?i[G]?(this.cursor.insRightOf(this),delete i[G][X],this.ends[X]=i[G],i.jQ.remove(),this.bubble("redraw"),e.preventDefault(),!1):void 0:(n=rt(),n.parent=this,n.jQ=Z("<span></span>").attr(F,n.id).appendTo(this.jQ),this.ends[X]=n,i[X]=n,n[G]=i,this.bubble("redraw").cursor.insAtRightEnd(n),e.preventDefault(),!1);if(8===e.which){if(i.isEmpty())return i[G]?(this.cursor.insAtRightEnd(i[G]),i[G][X]=i[X]):(this.cursor.insLeftOf(this),this.ends[G]=i[X]),i[X]?i[X][G]=i[G]:this.ends[X]=i[G],i.jQ.remove(),this.isEmpty()?this.cursor.deleteForward():this.bubble("redraw"),e.preventDefault(),!1;if(!this.cursor[G])return e.preventDefault(),!1}}}}),lt.editable=H(ot,function(t,e){t.init=function(){nt.prototype.init.call(this,"\\editable")},t.jQadd=function(){var t,n,i=this;e.jQadd.apply(i,arguments),t=i.ends[G].disown(),n=i.jQ.children().detach(),i.ends[G]=i.ends[X]=at(),i.blocks=[i.ends[G]],i.ends[G].parent=i,r(i.jQ,i.ends[G],!1,!0),i.cursor=i.ends[G].cursor,t.children().adopt(i.ends[G],0,0),n.appendTo(i.ends[G].jQ),i.ends[G].cursor.insAtRightEnd(i.ends[G])},t.latex=function(){return this.ends[G].latex()},t.text=function(){return this.ends[G].text()}}),lt.f=e(it,"f",'<var class="florin">&fnof;</var><span style="display:inline-block;width:0">&nbsp;</span>'),D=H(it,function(t,e){t.init=function(t,n){e.init.call(this,t,"<var>"+(n||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return!this[G]||this[G]instanceof D||this[G]instanceof R||(t="*"+t),!this[X]||this[X]instanceof R||"^"===this[X].ctrlSeq||(t+="*"),t}}),O=H(it,function(t,e){t.init=function(t,n){e.init.call(this,t,"<span>"+(n||t)+"</span>")}}),ht[" "]=e(O,"\\:"," "),lt.prime=ht["'"]=e(O,"'","&prime;"),E=H(it,function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="nonSymbola">'+(n||t)+"</span>")}}),lt["@"]=E,lt["&"]=e(E,"\\&","&amp;"),lt["%"]=e(E,"\\%","%"),lt.alpha=lt.beta=lt.gamma=lt.delta=lt.zeta=lt.eta=lt.theta=lt.iota=lt.kappa=lt.mu=lt.nu=lt.xi=lt.rho=lt.sigma=lt.tau=lt.chi=lt.psi=lt.omega=H(D,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),lt.phi=e(D,"\\phi ","&#981;"),lt.phiv=lt.varphi=e(D,"\\varphi ","&phi;"),lt.epsilon=e(D,"\\epsilon ","&#1013;"),lt.epsiv=lt.varepsilon=e(D,"\\varepsilon ","&epsilon;"),lt.piv=lt.varpi=e(D,"\\varpi ","&piv;"),lt.sigmaf=lt.sigmav=lt.varsigma=e(D,"\\varsigma ","&sigmaf;"),lt.thetav=lt.vartheta=lt.thetasym=e(D,"\\vartheta ","&thetasym;"),lt.upsilon=lt.upsi=e(D,"\\upsilon ","&upsilon;"),lt.gammad=lt.Gammad=lt.digamma=e(D,"\\digamma ","&#989;"),lt.kappav=lt.varkappa=e(D,"\\varkappa ","&#1008;"),lt.rhov=lt.varrho=e(D,"\\varrho ","&#1009;"),lt.pi=lt["π"]=e(E,"\\pi ","&pi;"),lt.lambda=e(E,"\\lambda ","&lambda;"),lt.Upsilon=lt.Upsi=lt.upsih=lt.Upsih=e(it,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),lt.Gamma=lt.Delta=lt.Theta=lt.Lambda=lt.Xi=lt.Pi=lt.Sigma=lt.Phi=lt.Psi=lt.Omega=lt.forall=H(O,function(t,e){
t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),A=H(nt,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){t.writeLatex(this.latex)},t.parser=function(){var t=$.parse(this.latex).children();return N.succeed(t)}}),lt["¹"]=e(A,"^1"),lt["²"]=e(A,"^2"),lt["³"]=e(A,"^3"),lt["¼"]=e(A,"\\frac14"),lt["½"]=e(A,"\\frac12"),lt["¾"]=e(A,"\\frac34"),R=H(it,function(t,e){t.init=function(t,n,i){e.init.call(this,t,'<span class="binary-operator">'+n+"</span>",i)}}),T=H(R,function(t){t.init=O.prototype.init,t.respace=function(){return this[G]?this[G]instanceof R&&this[X]&&!(this[X]instanceof R)?this.jQ[0].className="unary-operator":this.jQ[0].className="binary-operator":this.jQ[0].className="",this}}),lt["+"]=e(T,"+","+"),lt["–"]=lt["-"]=e(T,"-","&minus;"),lt["±"]=lt.pm=lt.plusmn=lt.plusminus=e(T,"\\pm ","&plusmn;"),lt.mp=lt.mnplus=lt.minusplus=e(T,"\\mp ","&#8723;"),ht["*"]=lt.sdot=lt.cdot=e(R,"\\cdot ","&middot;"),lt["="]=e(R,"=","="),lt["<"]=e(R,"<","&lt;"),lt[">"]=e(R,">","&gt;"),lt.notin=lt.sim=lt.cong=lt.equiv=lt.oplus=lt.otimes=H(R,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),lt.times=e(R,"\\times ","&times;","[x]"),lt["÷"]=lt.div=lt.divide=lt.divides=e(R,"\\div ","&divide;","[/]"),lt["≠"]=lt.ne=lt.neq=e(R,"\\ne ","&ne;"),lt.ast=lt.star=lt.loast=lt.lowast=e(R,"\\ast ","&lowast;"),lt.therefor=lt.therefore=e(R,"\\therefore ","&there4;"),lt.cuz=lt.because=e(R,"\\because ","&#8757;"),lt.prop=lt.propto=e(R,"\\propto ","&prop;"),lt["≈"]=lt.asymp=lt.approx=e(R,"\\approx ","&asymp;"),lt.lt=e(R,"<","&lt;"),lt.gt=e(R,">","&gt;"),lt["≤"]=lt.le=lt.leq=e(R,"\\le ","&le;"),lt["≥"]=lt.ge=lt.geq=e(R,"\\ge ","&ge;"),lt.isin=lt["in"]=e(R,"\\in ","&isin;"),lt.ni=lt.contains=e(R,"\\ni ","&ni;"),lt.notni=lt.niton=lt.notcontains=lt.doesnotcontain=e(R,"\\not\\ni ","&#8716;"),lt.sub=lt.subset=e(R,"\\subset ","&sub;"),lt.sup=lt.supset=lt.superset=e(R,"\\supset ","&sup;"),lt.nsub=lt.notsub=lt.nsubset=lt.notsubset=e(R,"\\not\\subset ","&#8836;"),lt.nsup=lt.notsup=lt.nsupset=lt.notsupset=lt.nsuperset=lt.notsuperset=e(R,"\\not\\supset ","&#8837;"),lt.sube=lt.subeq=lt.subsete=lt.subseteq=e(R,"\\subseteq ","&sube;"),lt.supe=lt.supeq=lt.supsete=lt.supseteq=lt.supersete=lt.superseteq=e(R,"\\supseteq ","&supe;"),lt.nsube=lt.nsubeq=lt.notsube=lt.notsubeq=lt.nsubsete=lt.nsubseteq=lt.notsubsete=lt.notsubseteq=e(R,"\\not\\subseteq ","&#8840;"),lt.nsupe=lt.nsupeq=lt.notsupe=lt.notsupeq=lt.nsupsete=lt.nsupseteq=lt.notsupsete=lt.notsupseteq=lt.nsupersete=lt.nsuperseteq=lt.notsupersete=lt.notsuperseteq=e(R,"\\not\\supseteq ","&#8841;"),z=H(it,function(t,e){t.init=function(t,n){e.init.call(this,t,"<big>"+n+"</big>")}}),lt["∑"]=lt.sum=lt.summation=e(z,"\\sum ","&sum;"),lt["∏"]=lt.prod=lt.product=e(z,"\\prod ","&prod;"),lt.coprod=lt.coproduct=e(z,"\\coprod ","&#8720;"),lt["∫"]=lt["int"]=lt.integral=e(z,"\\int ","&int;"),lt.N=lt.naturals=lt.Naturals=e(O,"\\mathbb{N}","&#8469;"),lt.P=lt.primes=lt.Primes=lt.projective=lt.Projective=lt.probability=lt.Probability=e(O,"\\mathbb{P}","&#8473;"),lt.Z=lt.integers=lt.Integers=e(O,"\\mathbb{Z}","&#8484;"),lt.Q=lt.rationals=lt.Rationals=e(O,"\\mathbb{Q}","&#8474;"),lt.R=lt.reals=lt.Reals=e(O,"\\mathbb{R}","&#8477;"),lt.C=lt.complex=lt.Complex=lt.complexes=lt.Complexes=lt.complexplane=lt.Complexplane=lt.ComplexPlane=e(O,"\\mathbb{C}","&#8450;"),lt.H=lt.Hamiltonian=lt.quaternions=lt.Quaternions=e(O,"\\mathbb{H}","&#8461;"),lt.quad=lt.emsp=e(O,"\\quad ","    "),lt.qquad=e(O,"\\qquad ","        "),lt.diamond=e(O,"\\diamond ","&#9671;"),lt.bigtriangleup=e(O,"\\bigtriangleup ","&#9651;"),lt.ominus=e(O,"\\ominus ","&#8854;"),lt.uplus=e(O,"\\uplus ","&#8846;"),lt.bigtriangledown=e(O,"\\bigtriangledown ","&#9661;"),lt.sqcap=e(O,"\\sqcap ","&#8851;"),lt.triangleleft=e(O,"\\triangleleft ","&#8882;"),lt.sqcup=e(O,"\\sqcup ","&#8852;"),lt.triangleright=e(O,"\\triangleright ","&#8883;"),lt.odot=e(O,"\\odot ","&#8857;"),lt.bigcirc=e(O,"\\bigcirc ","&#9711;"),lt.dagger=e(O,"\\dagger ","&#0134;"),lt.ddagger=e(O,"\\ddagger ","&#135;"),lt.wr=e(O,"\\wr ","&#8768;"),lt.amalg=e(O,"\\amalg ","&#8720;"),lt.models=e(O,"\\models ","&#8872;"),lt.prec=e(O,"\\prec ","&#8826;"),lt.succ=e(O,"\\succ ","&#8827;"),lt.preceq=e(O,"\\preceq ","&#8828;"),lt.succeq=e(O,"\\succeq ","&#8829;"),lt.simeq=e(O,"\\simeq ","&#8771;"),lt.mid=e(O,"\\mid ","&#8739;"),lt.ll=e(O,"\\ll ","&#8810;"),lt.gg=e(O,"\\gg ","&#8811;"),lt.parallel=e(O,"\\parallel ","&#8741;"),lt.bowtie=e(O,"\\bowtie ","&#8904;"),lt.sqsubset=e(O,"\\sqsubset ","&#8847;"),lt.sqsupset=e(O,"\\sqsupset ","&#8848;"),lt.smile=e(O,"\\smile ","&#8995;"),lt.sqsubseteq=e(O,"\\sqsubseteq ","&#8849;"),lt.sqsupseteq=e(O,"\\sqsupseteq ","&#8850;"),lt.doteq=e(O,"\\doteq ","&#8784;"),lt.frown=e(O,"\\frown ","&#8994;"),lt.vdash=e(O,"\\vdash ","&#8870;"),lt.dashv=e(O,"\\dashv ","&#8867;"),lt.longleftarrow=e(O,"\\longleftarrow ","&#8592;"),lt.longrightarrow=e(O,"\\longrightarrow ","&#8594;"),lt.Longleftarrow=e(O,"\\Longleftarrow ","&#8656;"),lt.Longrightarrow=e(O,"\\Longrightarrow ","&#8658;"),lt.longleftrightarrow=e(O,"\\longleftrightarrow ","&#8596;"),lt.updownarrow=e(O,"\\updownarrow ","&#8597;"),lt.Longleftrightarrow=e(O,"\\Longleftrightarrow ","&#8660;"),lt.Updownarrow=e(O,"\\Updownarrow ","&#8661;"),lt.mapsto=e(O,"\\mapsto ","&#8614;"),lt.nearrow=e(O,"\\nearrow ","&#8599;"),lt.hookleftarrow=e(O,"\\hookleftarrow ","&#8617;"),lt.hookrightarrow=e(O,"\\hookrightarrow ","&#8618;"),lt.searrow=e(O,"\\searrow ","&#8600;"),lt.leftharpoonup=e(O,"\\leftharpoonup ","&#8636;"),lt.rightharpoonup=e(O,"\\rightharpoonup ","&#8640;"),lt.swarrow=e(O,"\\swarrow ","&#8601;"),lt.leftharpoondown=e(O,"\\leftharpoondown ","&#8637;"),lt.rightharpoondown=e(O,"\\rightharpoondown ","&#8641;"),lt.nwarrow=e(O,"\\nwarrow ","&#8598;"),lt.ldots=e(O,"\\ldots ","&#8230;"),lt.cdots=e(O,"\\cdots ","&#8943;"),lt.vdots=e(O,"\\vdots ","&#8942;"),lt.ddots=e(O,"\\ddots ","&#8944;"),lt.surd=e(O,"\\surd ","&#8730;"),lt.triangle=e(O,"\\triangle ","&#9653;"),lt.ell=e(O,"\\ell ","&#8467;"),lt.top=e(O,"\\top ","&#8868;"),lt.flat=e(O,"\\flat ","&#9837;"),lt.natural=e(O,"\\natural ","&#9838;"),lt.sharp=e(O,"\\sharp ","&#9839;"),lt.wp=e(O,"\\wp ","&#8472;"),lt.bot=e(O,"\\bot ","&#8869;"),lt.clubsuit=e(O,"\\clubsuit ","&#9827;"),lt.diamondsuit=e(O,"\\diamondsuit ","&#9826;"),lt.heartsuit=e(O,"\\heartsuit ","&#9825;"),lt.spadesuit=e(O,"\\spadesuit ","&#9824;"),lt.oint=e(O,"\\oint ","&#8750;"),lt.bigcap=e(O,"\\bigcap ","&#8745;"),lt.bigcup=e(O,"\\bigcup ","&#8746;"),lt.bigsqcup=e(O,"\\bigsqcup ","&#8852;"),lt.bigvee=e(O,"\\bigvee ","&#8744;"),lt.bigwedge=e(O,"\\bigwedge ","&#8743;"),lt.bigodot=e(O,"\\bigodot ","&#8857;"),lt.bigotimes=e(O,"\\bigotimes ","&#8855;"),lt.bigoplus=e(O,"\\bigoplus ","&#8853;"),lt.biguplus=e(O,"\\biguplus ","&#8846;"),lt.lfloor=e(O,"\\lfloor ","&#8970;"),lt.rfloor=e(O,"\\rfloor ","&#8971;"),lt.lceil=e(O,"\\lceil ","&#8968;"),lt.rceil=e(O,"\\rceil ","&#8969;"),lt.slash=e(O,"\\slash ","&#47;"),lt.opencurlybrace=e(O,"\\opencurlybrace ","&#123;"),lt.closecurlybrace=e(O,"\\closecurlybrace ","&#125;"),lt.caret=e(O,"\\caret ","^"),lt.underscore=e(O,"\\underscore ","_"),lt.backslash=e(O,"\\backslash ","\\"),lt.vert=e(O,"|"),lt.perp=lt.perpendicular=e(O,"\\perp ","&perp;"),lt.nabla=lt.del=e(O,"\\nabla ","&nabla;"),lt.hbar=e(O,"\\hbar ","&#8463;"),lt.AA=lt.Angstrom=lt.angstrom=e(O,"\\text\\AA ","&#8491;"),lt.ring=lt.circ=lt.circle=e(O,"\\circ ","&#8728;"),lt.bull=lt.bullet=e(O,"\\bullet ","&bull;"),lt.setminus=lt.smallsetminus=e(O,"\\setminus ","&#8726;"),lt.not=lt["¬"]=lt.neg=e(O,"\\neg ","&not;"),lt["…"]=lt.dots=lt.ellip=lt.hellip=lt.ellipsis=lt.hellipsis=e(O,"\\dots ","&hellip;"),lt.converges=lt.darr=lt.dnarr=lt.dnarrow=lt.downarrow=e(O,"\\downarrow ","&darr;"),lt.dArr=lt.dnArr=lt.dnArrow=lt.Downarrow=e(O,"\\Downarrow ","&dArr;"),lt.diverges=lt.uarr=lt.uparrow=e(O,"\\uparrow ","&uarr;"),lt.uArr=lt.Uparrow=e(O,"\\Uparrow ","&uArr;"),lt.to=e(R,"\\to ","&rarr;"),lt.rarr=lt.rightarrow=e(O,"\\rightarrow ","&rarr;"),lt.implies=e(R,"\\Rightarrow ","&rArr;"),lt.rArr=lt.Rightarrow=e(O,"\\Rightarrow ","&rArr;"),lt.gets=e(R,"\\gets ","&larr;"),lt.larr=lt.leftarrow=e(O,"\\leftarrow ","&larr;"),lt.impliedby=e(R,"\\Leftarrow ","&lArr;"),lt.lArr=lt.Leftarrow=e(O,"\\Leftarrow ","&lArr;"),lt.harr=lt.lrarr=lt.leftrightarrow=e(O,"\\leftrightarrow ","&harr;"),lt.iff=e(R,"\\Leftrightarrow ","&hArr;"),lt.hArr=lt.lrArr=lt.Leftrightarrow=e(O,"\\Leftrightarrow ","&hArr;"),lt.Re=lt.Real=lt.real=e(O,"\\Re ","&real;"),lt.Im=lt.imag=lt.image=lt.imagin=lt.imaginary=lt.Imaginary=e(O,"\\Im ","&image;"),lt.part=lt.partial=e(O,"\\partial ","&part;"),lt.inf=lt.infin=lt.infty=lt.infinity=e(O,"\\infty ","&infin;"),lt.alef=lt.alefsym=lt.aleph=lt.alephsym=e(O,"\\aleph ","&alefsym;"),lt.xist=lt.xists=lt.exist=lt.exists=e(O,"\\exists ","&exist;"),lt.and=lt.land=lt.wedge=e(O,"\\wedge ","&and;"),lt.or=lt.lor=lt.vee=e(O,"\\vee ","&or;"),lt.o=lt.O=lt.empty=lt.emptyset=lt.oslash=lt.Oslash=lt.nothing=lt.varnothing=e(R,"\\varnothing ","&empty;"),lt.cup=lt.union=e(R,"\\cup ","&cup;"),lt.cap=lt.intersect=lt.intersection=e(R,"\\cap ","&cap;"),lt.deg=lt.degree=e(O,"^\\circ ","&deg;"),lt.ang=lt.angle=e(O,"\\angle ","&ang;"),B=H(it,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","<span>"+t+"</span>")},t.respace=function(){this.jQ[0].className=this[X]instanceof u||this[X]instanceof b?"":"non-italicized-function"}}),lt.ln=lt.lg=lt.log=lt.span=lt.proj=lt.det=lt.dim=lt.min=lt.max=lt.mod=lt.lcm=lt.gcd=lt.gcf=lt.hcf=lt.lim=B,function(){var t,e=["sin","cos","tan","sec","cosec","csc","cotan","cot"];for(t in e)lt[e[t]]=lt[e[t]+"h"]=lt["a"+e[t]]=lt["arc"+e[t]]=lt["a"+e[t]+"h"]=lt["arc"+e[t]+"h"]=B}(),$=function(){function t(t){var e=rt();return t.adopt(e,0,0),e}function e(t){var e,n=t[0]||rt();for(e=1;e<t.length;e+=1)t[e].children().adopt(n,n.ends[X],0);return n}var n=N.string,i=N.regex,r=N.letter,s=N.any,a=N.optWhitespace,o=N.succeed,c=N.fail,h=r.map(D),l=i(/^[^${}\\_^]/).map(O),u=i(/^[^\\a-eg-zA-Z]/).or(n("\\").then(i(/^[a-z]+/i).or(i(/^\s+/).result(" ")).or(s))).then(function(t){var e=lt[t];return e?e(t).parser():c("unknown command: \\"+t)}),p=u.or(h).or(l),f=n("{").then(function(){return m}).skip(n("}")),d=a.then(f.or(p.map(t))),m=d.many().map(e).skip(a),g=n("[").then(d.then(function(t){return"]"!==t.join("latex")?o(t):c()}).many().map(e).skip(a)).skip(n("]")),b=m;return b.block=d,b.optBlock=g,b}(),I=H(Y,function(t){function e(t,e){var i,r,s,a;if(t.clearSelection().show(),t[X][e])t.insAtLeftEnd(t[X][e]);else if(t[G][e])t.insAtRightEnd(t[G][e]);else{i=t.parent;do{if(r=i[e],r&&("function"==typeof r&&(r=i[e](t)),r===!1||r instanceof rt)){t.upDownCache[i.id]=Y(t.parent,t[G],t[X]),r instanceof rt&&(s=t.upDownCache[r.id],s?s[X]?t.insLeftOf(s[X]):t.insAtRightEnd(s.parent):(a=n(t).left,t.insAtRightEnd(r),t.seekHoriz(a,r)));break}i=i.parent.parent}while(i)}return t}function n(t){var e=t.jQ.removeClass("cursor").offset();return t.jQ.addClass("cursor"),e}function r(t){t.upDownCache={}}t.init=function(t){this.parent=this.root=t;var e=this.jQ=this._jQ=Z('<span class="cursor">&#8203;</span>');this.blink=function(){e.toggleClass("blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("blink"),"intervalId"in this?clearInterval(this.intervalId):(this[X]?this.selection&&this.selection.ends[G][G]===this[G]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[X].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=Z(),this},t.withDirInsertAt=function(t,e,n,i){var r=this.parent;this.parent=e,this[t]=n,this[-t]=i,r.blur()},t.insDirOf=function(t,e){return i(t),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("hasCursor"),this.jQ.insDirOf(t,e.jQ),this},t.insLeftOf=function(t){return this.insDirOf(G,t)},t.insRightOf=function(t){return this.insDirOf(X,t)},t.insAtDirEnd=function(t,e){return i(t),this.withDirInsertAt(t,e,0,e.ends[t]),t===G&&e.textarea?this.jQ.insDirOf(-t,e.textarea):this.jQ.insAtDirEnd(t,e.jQ),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(G,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(X,t)},t.hopDir=function(t){return i(t),this.jQ.insDirOf(t,this[t].jQ),this[-t]=this[t],this[t]=this[t][t],this},t.hopLeft=function(){return this.hopDir(G)},t.hopRight=function(){return this.hopDir(X)},t.moveDirWithin=function(t,e){if(i(t),this[t])this[t].ends[-t]?this.insAtDirEnd(-t,this[t].ends[-t]):this.hopDir(t);else{if(this.parent===e)return;this.parent[t]?this.insAtDirEnd(-t,this.parent[t]):this.insDirOf(t,this.parent.parent)}},t.moveLeftWithin=function(t){return this.moveDirWithin(G,t)},t.moveRightWithin=function(t){return this.moveDirWithin(X,t)},t.moveDir=function(t){return i(t),r(this),this.selection?this.insDirOf(t,this.selection.ends[t]).clearSelection():this.moveDirWithin(t,this.root),this.show()},t.moveLeft=function(){return this.moveDir(G)},t.moveRight=function(){return this.moveDir(X)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},t.seek=function(t,e,n){r(this);var i,s,a=this.clearSelection().show();return t.hasClass("empty")?(a.insAtLeftEnd(et[t.attr(F)]),a):(i=et[t.attr(M)],i instanceof it?(t.outerWidth()>2*(e-t.offset().left)?a.insLeftOf(i):a.insRightOf(i),a):(i||(s=et[t.attr(F)],s||(t=t.parent(),i=et[t.attr(M)],i||(s=et[t.attr(F)],s||(s=a.root)))),i?a.insRightOf(i):a.insAtRightEnd(s),a.seekHoriz(e,a.root)))},t.seekHoriz=function(t,e){var i,r=this,s=n(r).left-t;do r.moveLeftWithin(e),i=s,s=n(r).left-t;while(s>0&&(r[G]||r.parent!==e));return-s>i&&r.moveRightWithin(e),r},t.writeLatex=function(t){var e,n,i,s=this;return r(s),s.show().deleteSelection(),e=N.all,n=N.eof,i=$.skip(n).or(e.result(!1)).parse(t),i&&(i.children().adopt(s.parent,s[G],s[X]),et.jQize(i.join("html")).insertBefore(s.jQ),s[G]=i.ends[X],i.finalizeInsert(),s.parent.bubble("redraw")),this.hide()},t.write=function(t){var e=this.prepareWrite();return this.insertCh(t,e)},t.insertCh=function(t,e){return this.parent.write(this,t,e),this},t.insertCmd=function(t,e){var n=lt[t];return n?(n=n(t),e&&n.replaces(e),n.createLeftOf(this)):(n=k(),n.replaces(t),n.ends[G].focus=function(){return delete this.focus,this},n.createLeftOf(this),this.insRightOf(n),e&&e.remove()),this},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,n=t[X],i=t[G];if(t.disown().eachChild(function(r){r.isEmpty()||(r.children().adopt(e,i,n).each(function(e){e.jQ.insertBefore(t.jQ.first())}),i=r.ends[X])}),!this[X])if(this[G])this[X]=this[G][X];else for(;!this[X];){if(this.parent=this.parent[X],!this.parent){this[X]=t[X],this.parent=e;break}this[X]=this.parent.ends[G]}this[X]?this.insLeftOf(this[X]):this.insAtRightEnd(e),t.jQ.remove(),t[G]&&t[G].respace(),t[X]&&t[X].respace()},t.deleteDir=function(t){if(i(t),r(this),this.show(),this.deleteSelection());else if(this[t])this[t].isEmpty()?this[t]=this[t].remove()[t]:this.selectDir(t);else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insDirOf(-t,this.parent.parent).deleteDir(t);this.unwrapGramp()}return this[G]&&this[G].respace(),this[X]&&this[X].respace(),this.parent.bubble("redraw"),this},t.backspace=function(){return this.deleteDir(G)},t.deleteForward=function(){return this.deleteDir(X)},t.selectFrom=function(t){var e,n,i,r,s,a,o=this,c=t;t:for(;;){for(e=this;e!==o.parent.parent;e=e.parent.parent)if(e.parent===c.parent){i=e,r=c;break t}for(n=t;n!==c.parent.parent;n=n.parent.parent)if(o.parent===n.parent){i=o,r=n;break t}o.parent.parent&&(o=o.parent.parent),c.parent.parent&&(c=c.parent.parent)}if(i[X]!==r){for(a=i;a;a=a[X])if(a===r[G]){s=!0;break}s||(s=r,r=i,i=s)}this.hide().selection=_(i[G][X]||i.parent.ends[G],r[X][G]||r.parent.ends[X]),this.insRightOf(r[X][G]||r.parent.ends[X]),this.root.selectionChanged()},t.selectDir=function(t){if(i(t),r(this),this.selection)if(this.selection.ends[t]===this[-t])this[t]?this.hopDir(t).selection.extendDir(t):this.parent!==this.root&&this.insDirOf(t,this.parent.parent).selection.levelUp();else{if(this.hopDir(t),this.selection.ends[t]===this.selection.ends[-t])return void this.clearSelection().show();this.selection.retractDir(t)}else{if(this[t])this.hopDir(t);else{if(this.parent===this.root)return;this.insDirOf(t,this.parent.parent)}this.hide().selection=_(this[-t])}this.root.selectionChanged()},t.selectLeft=function(){return this.selectDir(G)},t.selectRight=function(){return this.selectDir(X)},t.prepareMove=function(){return r(this),this.show().clearSelection()},t.prepareEdit=function(){return r(this),this.show().deleteSelection()},t.prepareWrite=function(){return r(this),this.show().replaceSelection()},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.root.selectionChanged()),this},t.deleteSelection=function(){return this.selection?(this[G]=this.selection.ends[G][G],this[X]=this.selection.ends[X][X],this.selection.remove(),this.root.selectionChanged(),delete this.selection):!1},t.replaceSelection=function(){var t=this.selection;return t&&(this[G]=t.ends[G][G],this[X]=t.ends[X][X],delete this.selection),t}}),_=H(st,function(t,e){t.init=function(){var t=this;e.init.apply(t,arguments),t.jQwrap(t.jQ)},t.jQwrap=function(t){this.jQ=t.wrapAll('<span class="selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ.children()),this},t.levelUp=function(){var t=this,e=t.ends[G]=t.ends[X]=t.ends[X].parent.parent;return t.clear().jQwrap(e.jQ),t},t.extendDir=function(t){return i(t),this.ends[t]=this.ends[t][t],this.ends[t].jQ.insAtDirEnd(t,this.jQ),this},t.extendLeft=function(){return this.extendDir(G)},t.extendRight=function(){return this.extendDir(X)},t.retractDir=function(t){i(t),this.ends[-t].jQ.insDirOf(-t,this.jQ),this.ends[-t]=this.ends[-t][t]},t.retractRight=function(){return this.retractDir(X)},t.retractLeft=function(){return this.retractDir(G)}}),W.fn.mathquill=function(t,e){var n,i,s,a,o;switch(t){case"redraw":return this.each(function(){var t=Z(this).attr(F),e=t&&et[t];e&&!function n(t){t.eachChild(n),t.redraw&&t.redraw()}(e)});case"revert":return this.each(function(){var t=Z(this).attr(F),e=t&&et[t];e&&e.revert&&e.revert()});case"latex":return arguments.length>1?this.each(function(){var t=Z(this).attr(F),n=t&&et[t];n&&n.renderLatex(e)}):(n=Z(this).attr(F),i=n&&et[n],i&&i.latex());case"text":return n=Z(this).attr(F),i=n&&et[n],i&&i.text();case"html":return this.html().replace(/ ?hasCursor|hasCursor /,"").replace(/ class=(""|(?= |>))/g,"").replace(/<span class="?cursor( blink)?"?><\/span>/i,"").replace(/<span class="?textarea"?><textarea><\/textarea><\/span>/i,"");case"write":if(arguments.length>1)return this.each(function(){var t=Z(this).attr(F),n=t&&et[t],i=n&&n.cursor;i&&i.writeLatex(e).parent.blur()});case"cmd":if(arguments.length>1)return this.each(function(){var t,n=Z(this).attr(F),i=n&&et[n],r=i&&i.cursor;r&&(t=r.prepareWrite(),/^\\[a-z]+$/i.test(e)?r.insertCmd(e.slice(1),t):r.insertCh(e,t),r.hide().parent.blur())});default:return s="textbox"===t,a=s||"editable"===t,o=s?ct:at,this.each(function(){r(Z(this),o(),s,a)})}},W(function(){W(".mathquill-editable:not(.mathquill-rendered-math)").mathquill("editable"),W(".mathquill-textbox:not(.mathquill-rendered-math)").mathquill("textbox"),W(".mathquill-embedded-latex").mathquill()}),"object"==typeof exports&&(require("./mathquill.css"),module.exports=function(t,e){W(t).mathquill(e)})}();
